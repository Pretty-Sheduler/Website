<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Scheduler — Sign In</title>
  <style>
    body { 
      margin: 0; 
      font-family: sans-serif; 
      background: #f0f2f5; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
    }
    #login-card {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
      width: 320px;
    }
    #login-card h2 { margin-bottom: 1rem; }
    #login-card button {
      width: 100%;
      padding: 0.75rem;
      background: #0069d9;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    #login-card button:hover { background: #0053a6; }
    #error { color: #d00; margin-top: 0.75rem; }
  </style>
  <script>
    // ── YOUR COGNITO CONFIG ────────────────────────────────────────
    const DOMAIN_PREFIX = 'us-east-2hhsi9dslk';  // your Cognito domain prefix
    const CLIENT_ID     = '6887lmtltpfidijg07a34bpps4';
    const REDIRECT_URI  = 'https://pretty-sheduler.github.io/Website/';  // ensure this matches your callback URL in Cognito
    const SCOPES        = 'openid email';
    // ────────────────────────────────────────────────────────────────

    // Build the Hosted UI URL
    function launchLogin() {
      const url = new URL(
        `https://${DOMAIN_PREFIX}.auth.us-east-2.amazoncognito.com/oauth2/authorize`
      );
      url.searchParams.set('response_type', 'token');
      url.searchParams.set('client_id', CLIENT_ID);
      url.searchParams.set('redirect_uri', REDIRECT_URI);
      url.searchParams.set('scope', SCOPES);
      window.location.href = url.toString();
    }

    // Parse the URL hash fragment into an object
    function parseHash(hash) {
      return hash
        .substring(1)
        .split('&')
        .map(pair => pair.split('='))
        .reduce((acc, [k,v]) => {
          acc[k] = decodeURIComponent(v);
          return acc;
        }, {});
    }

    // On page load, check if Cognito just redirected us back with tokens
    window.addEventListener('DOMContentLoaded', () => {
      const hash = window.location.hash;
      if (hash.startsWith('#')) {
        const params = parseHash(hash);
        if (params.id_token) {
          // Store the ID token and clear the hash
          // after parsing the hash:
            localStorage.setItem('idToken',     params.id_token);
            localStorage.setItem('accessToken', params.access_token);

          history.replaceState(null, '', REDIRECT_URI);
          // Redirect to your protected app page
          window.location.href = 'dashboard.html';
          return;
        }
        if (params.error) {
          document.getElementById('error').textContent =
            params.error_description || params.error;
        }
      }
      // Show the login UI if not already signed in
      document.getElementById('login-card').style.display = 'block';
    });
  </script>
</head>

<body>
  <div id="login-card" style="display:none;">
    <h2>Welcome to My Scheduler</h2>
    <button onclick="launchLogin()">
      Log in with Email or Google
    </button>
    <div id="error"></div>
  </div>
</body>
</html>
