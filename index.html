<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Scheduler — Sign In</title>
  <style>
    body { font-family: sans-serif; background:#f0f2f5; margin:0; display:flex; align-items:center; justify-content:center; height:100vh; }
    #login, #error { width:300px; padding:1rem; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); text-align:center; }
    #login button { width:100%; padding:0.75rem; background:#0069d9; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:1rem; }
    #login button:hover { background:#0053a6; }
    #error { color:#d00; margin-top:0.5rem; }
  </style>
  <script>
    // ── YOUR COGNITO CONFIG ──────────────────────────────────────
    const COGNITO_DOMAIN = 'us-east-2hhsi9dslk.auth.us-east-2.amazoncognito.com';
    const CLIENT_ID      = '5sch6q2v6m5doglvndfvqssbhg';
    const REDIRECT_URI   = window.location.origin;  // must match your Cognito callback URL
    const SCOPES         = 'openid email profile';
    // ──────────────────────────────────────────────────────────────

    // Parse URL hash into an object
    function parseHash(hash) {
      return hash
        .slice(1)
        .split('&')
        .map(pair => pair.split('='))
        .reduce((acc, [k,v]) => {
          acc[k] = decodeURIComponent(v);
          return acc;
        }, {});
    }

    window.addEventListener('DOMContentLoaded', () => {
      const hash = window.location.hash;
      if (hash.startsWith('#')) {
        const params = parseHash(hash);
        if (params.id_token) {
          // store the token and clear the hash
          localStorage.setItem('idToken', params.id_token);
          history.replaceState(null, '', REDIRECT_URI + '/');
          // go to your app
          window.location.href = 'dashboard.html';
          return;
        }
        if (params.error) {
          document.getElementById('error').textContent =
            `Auth error: ${params.error_description || params.error}`;
        }
      }
      // show login button if not already signed in
      document.getElementById('login').style.display = 'block';
    });

    function launchLogin() {
      const url = new URL(`https://${COGNITO_DOMAIN}/login`);
      url.searchParams.set('response_type', 'token');
      url.searchParams.set('client_id', CLIENT_ID);
      url.searchParams.set('redirect_uri', REDIRECT_URI);
      url.searchParams.set('scope', SCOPES);
      window.location.href = url.toString();
    }
  </script>
</head>
<body>
  <div id="login" style="display:none;">
    <h2>Sign In</h2>
    <button onclick="launchLogin()">Log in with Email or Google</button>
    <div id="error"></div>
  </div>
</body>
</html>
